<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Family Finance - Phase 3 Plaid Ready</title>
<style>
  body { background:#0a0a0f; font-family: 'Inter', sans-serif; color:#e7ecf3; margin:0; padding:0; }
  header { padding:1em; text-align:center; font-size:1.5em; font-weight:bold; color:#00d7c0; text-shadow:0 0 15px #7c5cff; }
  .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:1em; margin:1em; }
  .tile { background:#14161b; border-radius:20px; padding:1em; box-shadow:0 0 15px #7c5cff; transition:0.3s; }
  .tile:hover { transform:translateY(-5px); box-shadow:0 0 25px #00d7c0; }
  .btn { background:#7c5cff; color:white; border:none; padding:0.5em 1em; margin:0.2em; border-radius:20px; cursor:pointer; transition:0.3s; }
  .btn:hover { background:#00d7c0; }
  .bank-boxes { display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:0.5em; }
  .bank-box { background:#1a1d25; padding:0.5em; border-radius:12px; text-align:center; box-shadow:0 0 8px #7c5cff; cursor:pointer; }
  .motivation { font-size:1.2em; text-align:center; margin-top:0.5em; color:#00d7c0; text-shadow:0 0 8px #7c5cff; animation:fadeIn 2s infinite alternate; }
  @keyframes fadeIn { from{opacity:0.6;} to{opacity:1;} }
  table { width:100%; border-collapse:collapse; margin-top:0.5em; }
  td,th { border-bottom:1px solid #2a2d35; padding:0.4em; }
  .transaction-list { text-align:left; font-size:0.9em; margin-top:0.5em; }
</style>
<script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
</head>
<body>
<header>üí∞ Smart Family Finance - Phase 3 Plaid Ready</header>

<div class="grid">
  <div class="tile"><h2>Spendable Now</h2><div id="spendable-now">$0.00</div></div>
  <div class="tile"><h2>Daily Budget</h2><div id="daily-budget">$0.00/day</div></div>
  <div class="tile"><h2>Next Payday</h2><div id="next-payday">--</div><div id="payday-countdown"></div></div>
  <div class="tile"><h2>Banks</h2><div class="bank-boxes" id="bank-boxes"></div><div id="transactions" class="transaction-list hidden"></div></div>
  <div class="tile"><h2>Recurring Bills</h2><ul id="bill-list"></ul></div>
  <div class="tile"><h2>Spending by Category</h2><div>Total: <span id="category-total">$0.00</span></div><table id="category-table"></table></div>
  <div class="tile"><h2>AI Insights</h2><div id="ai-insights">--</div><div class="motivation" id="motivation"></div></div>
  <div class="tile"><h2>Settings</h2>
    Mode:
    <select id="mode-toggle" onchange="toggleMode()">
      <option value="demo">Demo</option>
      <option value="live">Live</option>
    </select>
  </div>
</div>

<script>
// Demo data
const DEMO_BALANCES=[
 {name:"BofA",balance:1027.42,transactions:["Deposit +$500","Grocery -$50","Rent -$900"]},
 {name:"SoFi",balance:400.00,transactions:["Transfer +$200","Gas -$60"]},
 {name:"USAA",balance:1851.04,transactions:["Paycheck +$1850","Utilities -$120"]},
 {name:"Capital One",balance:600.00,transactions:["Fun -$80","Disneyland -$220"]}
];
let DEMO_BILLS=[
 {name:"Rent (part 1)",amount:900,due:"2025-09-01"},
 {name:"NV Energy",amount:150,due:"2025-09-05"},
 {name:"Internet",amount:80,due:"2025-09-07"}
];
const DEMO_CATEGORIES=[
 {name:"Rent/Mortgage",amount:900},
 {name:"Utilities",amount:230},
 {name:"Food & Dining",amount:400}
];

// Motivation
const MOTIVATION_MESSAGES=["üí™ You're crushing it!","‚ö° Hold strong!","üöÄ Keep going!"];
let motIndex=0;
function rotateMotivation(){document.getElementById("motivation").innerText=MOTIVATION_MESSAGES[motIndex];motIndex=(motIndex+1)%MOTIVATION_MESSAGES.length;}
setInterval(rotateMotivation,4000);

// Toggle Demo/Live
async function toggleMode(){
  const mode=document.getElementById("mode-toggle").value;
  if(mode==="demo"){
    refreshDashboard({balances:DEMO_BALANCES,bills:DEMO_BILLS,categories:DEMO_CATEGORIES});
    document.getElementById("ai-insights").innerText="üí° Running in Demo Mode";
  } else {
    try{
      const res=await fetch('/.netlify/functions/create_link_token');
      const data=await res.json();
      if(data.link_token){
        const handler=Plaid.create({
          token:data.link_token,
          onSuccess:(public_token,metadata)=>{
            document.getElementById("ai-insights").innerText="‚úÖ Plaid Connected!";
            // TODO: send public_token to Netlify backend for exchange
          },
          onExit:(err,metadata)=>{
            document.getElementById("ai-insights").innerText="‚ö†Ô∏è Plaid exited.";
          }
        });
        handler.open();
      } else {
        document.getElementById("ai-insights").innerText="‚ùå Failed to get link_token";
      }
    }catch(err){document.getElementById("ai-insights").innerText="‚ùå Error: "+err.message;}
  }
}

// Refresh Dashboard
function refreshDashboard(data={balances:DEMO_BALANCES,bills:DEMO_BILLS,categories:DEMO_CATEGORIES}){
  document.getElementById("bank-boxes").innerHTML=data.balances.map((a,i)=>`<div class="bank-box" onclick="showTransactions(${i})">${a.name}<br>$${a.balance.toFixed(2)}</div>`).join("");
  document.getElementById("bill-list").innerHTML=data.bills.map(b=>`<li>${b.name}: $${b.amount} (due ${b.due})</li>`).join("");
  document.getElementById("category-table").innerHTML=data.categories.map(c=>`<tr><td>${c.name}</td><td>$${c.amount}</td></tr>`).join("");
  document.getElementById("spendable-now").innerText="$"+data.balances.reduce((s,a)=>s+a.balance,0).toFixed(2);
  document.getElementById("category-total").innerText="$"+data.categories.reduce((s,c)=>s+c.amount,0).toFixed(2);
}
function showTransactions(i){
  const bank=DEMO_BALANCES[i];
  document.getElementById("transactions").innerHTML=`<strong>${bank.name} Transactions:</strong><ul>`+bank.transactions.map(t=>`<li>${t}</li>`).join("")+"</ul>";
  document.getElementById("transactions").classList.remove("hidden");
}

// Init
document.addEventListener("DOMContentLoaded",()=>{refreshDashboard();rotateMotivation();});
</script>
    <!-- your other content, tiles, etc. -->

  <button id="plaid-connect-btn">Connect Bank</button>

  <!-- Plaid script loader (only once in the file) -->
  <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>

  <!-- Your Plaid integration code -->
  <script>
  async function openPlaidLink() {
    try {
      const response = await fetch('/.netlify/functions/create_link_token');
      const data = await response.json();

      if (!data.link_token) {
        throw new Error('No link_token returned: ' + JSON.stringify(data));
      }

      const handler = Plaid.create({
        token: data.link_token,
        onSuccess: function(public_token, metadata) {
          console.log('Public Token: ', public_token);
          alert("‚úÖ Plaid connected!");
        },
        onExit: function(err, metadata) {
          console.log('Plaid exited', err, metadata);
        }
      });

      handler.open();
    } catch (err) {
      console.error('Error creating link token:', err);
      alert('‚ùå Error: ' + err.message);
    }
  }

  document.getElementById('plaid-connect-btn')
    .addEventListener('click', openPlaidLink);
  </script>
</body>
</html>

  
</body>
</html>

