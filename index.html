<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Family Finance Dashboard - Phase 2 Skeleton</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
  body {background:#0f1116;color:#e7ecf3;font-family:system-ui,sans-serif;margin:0;min-height:100vh;}
  header {padding:20px;background:#14161b;border-bottom:1px solid #1f2937;display:flex;justify-content:space-between;align-items:center;}
  header h1{margin:0;color:#7c5cff;}
  .stats{font-size:0.9rem;}
  main.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;padding:20px;}
  .tile{background:#14161b;border-radius:10px;padding:16px;box-shadow:0 0 10px rgba(124,92,255,0.4);}
  .tile h2{margin:0 0 10px;font-size:1.1rem;color:#a78bfa;}
  .btn{padding:8px 12px;background:#7c5cff;border:none;border-radius:6px;color:#fff;cursor:pointer;}
  #toasts{position:fixed;bottom:20px;right:20px;z-index:200;}
  .toast{background:#14161b;color:#fff;padding:10px 16px;margin-top:10px;border-radius:6px;
    box-shadow:0 0 10px rgba(124,92,255,0.7);animation:fadein 0.5s,fadeout 0.5s 3s;}
  @keyframes fadein{from{opacity:0;transform:translateX(100%);}to{opacity:1;transform:translateX(0);}}
  @keyframes fadeout{from{opacity:1;}to{opacity:0;}}
  </style>
</head>
<body>
<header>
  <h1>💰 Smart Family Finance - Phase 2 Skeleton</h1>
  <div class="stats">
    Mode: <select id="mode-toggle" onchange="refreshDashboard()">
      <option value="live">Live</option>
      <option value="demo">Demo</option>
    </select> |
    Next Payday: <span id="header-next-payday">--</span> | 
    Daily: <span id="header-daily">$--</span>
    <button class="btn" onclick="saveNow()">Save</button>
    <button class="btn" onclick="restoreNow()">Restore</button> <!-- 👈 new button -->
  </div>
</header>

<main class="grid">
  <section class="tile"><h2>Spendable Now</h2><div id="spendable-now" style="font-size:1.6rem;">$—</div></section>
  <section class="tile"><h2>Daily Budget</h2><div id="daily-budget">$—/day</div></section>
  <section class="tile"><h2>Next Payday</h2><div id="next-payday">--</div></section>
  <section class="tile"><h2>Upcoming Income</h2><ul id="upcoming-income"></ul></section>
  <section class="tile"><h2>Bills Due</h2><ul id="bills-due"></ul></section>
  <section class="tile"><h2>Balances by Bank</h2><ul id="bank-balances"></ul></section>
  <section class="tile"><h2>AI Insights</h2><div id="ai-insights">💡 Loading...</div></section>
</main>
<div id="toasts"></div>
<script>
// === Helpers ===
function formatCurrency(v){return "$"+Number(v).toFixed(2);}
function adjustForWeekend(date){const d=new Date(date);const day=d.getDay();if(day===0){d.setDate(d.getDate()-2);}else if(day===6){d.setDate(d.getDate()-1);}return d;}
function showToast(msg){const t=document.createElement("div");t.className="toast";t.innerText=msg;document.getElementById("toasts").appendChild(t);setTimeout(()=>t.remove(),4000);}
  // === Holiday + Payday Helpers ===
const US_BANK_HOLIDAYS_2025 = [
  "2025-01-01","2025-01-20","2025-02-17","2025-05-26","2025-06-19",
  "2025-07-04","2025-09-01","2025-10-13","2025-11-11","2025-11-27","2025-12-25"
].map(d => new Date(d+"T00:00:00"));

function isHoliday(d){
  return US_BANK_HOLIDAYS_2025.some(h => h.toDateString() === d.toDateString());
}
function rollbackWeekendHoliday(d){
  let x = new Date(d);
  // weekend rollback first
  x = adjustForWeekend(x);
  // holiday rollback (keep moving back until weekday and not a holiday)
  while (isHoliday(x) || x.getDay() === 0 || x.getDay() === 6) {
    x.setDate(x.getDate() - 1);
    x = adjustForWeekend(x);
  }
  return x;
}
function nextBiweekly(anchorISO, from = new Date()){
  const anchor = new Date(anchorISO + "T00:00:00");
  const ms14 = 14 * 24 * 3600 * 1000;
  if (from <= anchor) return rollbackWeekendHoliday(anchor);
  let t = anchor.getTime();
  while (t <= from.getTime()) t += ms14;
  return rollbackWeekendHoliday(new Date(t));
}
function nextSemiMonthly(days = [15,30], from = new Date()){
  const candidates = [];
  for (let m = 0; m < 3; m++){
    const firstOfMonth = new Date(from.getFullYear(), from.getMonth()+m, 1);
    days.forEach(day => {
      // treat 30 as "last day of month" style
      const lastDom = new Date(firstOfMonth.getFullYear(), firstOfMonth.getMonth()+1, 0).getDate();
      const dom = (day === 30) ? lastDom : day;
      const cand = new Date(firstOfMonth.getFullYear(), firstOfMonth.getMonth(), dom);
      if (cand > from) candidates.push(rollbackWeekendHoliday(cand));
    });
  }
  candidates.sort((a,b) => a - b);
  return candidates[0] ?? rollbackWeekendHoliday(new Date(from));
}
function computeNextPayday(){
  const from = new Date();
  const steveNext = nextBiweekly("2025-08-22", from);   // your biweekly anchor
  const tanciNext = nextSemiMonthly([15,30], from);     // semimonthly 15th & last day
  return (steveNext < tanciNext) ? steveNext : tanciNext;
}
// === Pay Schedules & Bills (placeholder until Plaid) ===
let PAY_SCHEDULES=[
  {who:"Steve (SoFi)",frequency:"biweekly",anchor:"2025-08-22",amount:400,target:"SoFi"},
  {who:"Steve (BofA)",frequency:"biweekly",anchor:"2025-08-22",amount:1027.42,target:"BofA"},
  {who:"Tanci (USAA)",frequency:"semimonthly",days:[15,30],amount:1851.04,target:"USAA"}
];
let DEFAULT_BILLS=[{name:"Rent (1st Half)",amount:350,cadence:"monthly",day:15},{name:"Rent (2nd Half)",amount:350,cadence:"monthly",day:30},{name:"NV Energy",amount:120,cadence:"monthly",day:10},{name:"Property Taxes",amount:400,cadence:"quarterly",day:30}];
let BANKS=["BofA","SoFi","USAA","CapOne"];

// === Plaid Hooks (to be wired in Phase 2) ===
async function fetchBalancesFromPlaid(){/* TODO: replace demo balances with Plaid API call */return [{name:"BofA",balance:1027.42},{name:"SoFi",balance:400},{name:"USAA",balance:1851.04}];}
async function fetchTransactionsFromPlaid(){/* TODO: replace demo transactions with Plaid API call */return [];}

// === Dashboard Refresh ===
async function refreshDashboard(){
  const today=new Date();const mode=document.getElementById("mode-toggle").value;
  let balances=[];
  if(mode==="demo"){balances=[{name:"Demo Checking",balance:2400},{name:"Demo Savings",balance:3200}];}
  else{balances=await fetchBalancesFromPlaid();}
  const total=balances.reduce((s,a)=>s+a.balance,0);
  document.getElementById("bank-balances").innerHTML=balances.map(a=>`<li>${a.name}: ${formatCurrency(a.balance)}</li>`).join("");
  document.getElementById("spendable-now").innerText=formatCurrency(total);
  document.getElementById("daily-budget").innerText=formatCurrency(total/14)+"/day";
  document.getElementById("ai-insights").innerText="💡 Demo insights: " + (total>1000?"✅ You're in good shape":"⚠️ Tight funds");
}
// === Backup ===
function saveNow(){localStorage.setItem("finance_data",JSON.stringify({PAY_SCHEDULES,DEFAULT_BILLS,BANKS}));showToast("Backup Saved");}
function restoreNow(){let data=localStorage.getItem("finance_data");if(data){const obj=JSON.parse(data);PAY_SCHEDULES=obj.PAY_SCHEDULES;DEFAULT_BILLS=obj.DEFAULT_BILLS;BANKS=obj.BANKS;refreshDashboard();showToast("Backup Restored");}}
document.addEventListener("DOMContentLoaded",()=>{refreshDashboard();});
</script>
</body>
</html>

